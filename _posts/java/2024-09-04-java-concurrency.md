---
title: 20分钟了解Java并发
date: 2024-09-04 10:00:00 +0800
categories: [Java]
tags: [java]
description: Java并发
pin: true
---

## 介绍
上一篇讲完了[Java容器](https://dengyaqi.github.io/posts/java-collections/)的概念与其底层数据结构原理，这一篇主要介绍Java并发的概念。


## 理论基础

### 1. 多线程的出现

由于CPU、内存、I/O 设备的速度是有极大差异的，为了合理利用 CPU 的高性能，平衡这三者的速度差异，计算机体系结构、操作系统、编译程序都做出了贡献，主要体现为:

  - CPU增加了缓存，以均衡与内存的速度差异；// 导致`可见性`问题
  - 操作系统增加了进程、线程，以分时复用 CPU，进而均衡 CPU 与 I/O 设备的速度差异；// 导致`原子性`问题
  - 编译程序优化指令执行次序，使得缓存能够得到更加合理地利用。// 导致`有序性`问题

总的来说，多线程的出现是由于硬件的发展和为了提高资源利用率所提出的概念、但是不同的设备设计会导致不同并发问题的出现，也就是可见性、原子性和有序性。

#### 为什么CPU增加缓存会导致可见性问题？
这个问题可被分为几个子问题来回答，1. CPU与内存速度的差异、2. 缓存的作用、3. 可见性问题。那我们依次来回答一下 : 

1. 现代CPU的运算速度非常快，能够在极短的时间内处理大量指令。然而，与之相比，内存(RAM)的访问速度要慢得多。虽然内存比硬盘等外部存储器快得多，但它仍然跟不上CPU的处理速度。当CPU需要从内存中读取或写入数据时，往往需要等待几百个甚至几千个CPU时钟周期才能完成一次内存访问。这个延迟会导致 CPU 在等待数据时出现空闲状态，浪费了宝贵的计算资源。为了弥补这一差异，CPU中引入了缓存(Cache)。

   程序的运行通常具有空间局部性和时间局部性。空间局部性指的是在访问某个存储单元后，通常会访问邻近的存储单元；时间局部性指的是某些数据或指令可能会在短时间内被多次访问。缓存利用这一特点，提前将常用数据从内存中加载到缓存中。

4. 那么缓存的作用就显而易见了，也就是用于暂时保存最近使用的数据，以加速数据访问速度。

5. 可见性问题

6. CPU缓存(Cache)是一个快速的存储层，用于暂时保存最近使用的数据，以加速数据访问速度。CPU缓存的层次结构(L1、L2、L3 缓存)逐层加大，但速度逐层减慢，接近内存的速度。
