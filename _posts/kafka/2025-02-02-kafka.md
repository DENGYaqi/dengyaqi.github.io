---
title: Kafka
date: 2025-02-02 10:00:00 +0800
categories: [Kafka]
tags: [kafka]
description: Kafka
pin: true
---

# Kafka

## 一、为什么使用消息队列

### 1.使用同步的通信方式来解决多个服务之间的通信

![同步通信的问题](/assets/img/kafka/使用同步的通信方式来解决多个服务之间的通信.png){: width="300" height="300" }
_同步通信流程_

同步的通信方式会存在性能和稳定性的问题。

### 2.使用异步的通信方式

![异步通信的优势与问题](/assets/img/kafka/使用异步的通信方式.png){: width="300" height="300" }
_异步通信流程_

- 下一个订单后直接订单创建成功，将有具体业务信息的请求放置于消息队列中，例如队列1、队列2、队列3。
- 下游的消费者会订阅队列，例如数据库里创建一条订单订阅队列1，给用户加积分订阅队列3。
- 消费成功后，有具体业务信息的请求会到消费者内消费

针对于同步的通信方式来说，异步的方式，可以让上游快速成功，极大提高了系统的吞吐量。而且在分布式系统中，通过下游多个服务的分布式事务的保障，也能保障业务执行之后的最终一致性。

## 二、消息队列的流派

### 1. 什么是 MQ

Message Queue（MQ），消息队列中间件。很多人都说：MQ 通过将消息的发送和接收分离来实现应用程序的异步和解偶，这个给人的直觉是—MQ 是异步的，用来解耦的，但是这个只是 MQ 的效果而不是目的。MQ 真正的目的是为了通讯，屏蔽底层复杂的通讯协议，定义了一套应用层的、更加简单的通讯协议。一个分布式系统中两个模块之间通讯要么是HTTP，要么是自己开发的（rpc） TCP，但是这两种协议其实都是原始的协议。HTTP协议很难实现两端通讯——模块 A可以调用B， B 也可以主动调用A，如果要做到这个两端都要背上 WebServer，而且还不支持长连接（HTTP 2.0 的库根本找不到）。TCP 就更加原始了，粘包、心跳、私有的协议，想一想头皮就发麻。MQ 所要做的就是在这些协议之上构建一个简单的“协议”——生产者/消费者模型。MQ 带给我的“协议”不是具体的通讯协议，而是更高层次通讯模型。它定义了两个对象——发送数据的叫生产者；接收数据的叫消费者， 提供一个SDK 让我们可以定义自己的生产者和消费者实现消息通讯而无视底层通讯协议
 
### 2. 有broker

这个流派通常有一台服务器作为 Broker，所有的消息都通过它中转。生产者把消息发送给它就结束自己的任务了，Broker 则把消息主动推送给消费者（或者消费者主动轮询)

重Topic

kafka， JMS （ActiveMQ）就属于这个流派，生产者会发送key和数据到Broker，由Broker比较key之后决定给哪个消费者。这种模式是我们最常见的模式，是我们对 MQ 最多的印象。在这种模式下一个topic往往是一个比较大的概念，甚至一个系统中就可能只有一个topic，topic 某种意义上就是 queue，生产者发送 key 相当于说：“hi，把数据放到 key 的队列中”

### 3. 无broker

## 三、Kafka的基本知识

### 1.Kafka的安装

### 2.kafka中的一些基本概念

### 3.创建topic

### 4发送消息

### 5.消费消息

### 6.关于消息的细节

### 7.单播消息

### 8.多播消息

### 9. 查看消费组的详细信息

## 四、Kafka中主题和分区的概念

### 1. 主题Topic

### 2. 分区Partition

- 1) 分区的概念

- 2) 创建多分区的主题

### 3. kafka中消息日志文件中保存的内容

## 五、Kafka集群操作

### 1. 搭建kafka集群(三个broker)

### 2 .副本的概念

### 3. 关于集群消费

- 1) 向集群发送消息

- 2) 从集群中消费消息

- 3) 指定消费组来消费消息

- 4) 分区分消费组的集群消费中的细节

## 六、Kafka的java客户端-生产者的实现

### 1. 生产者的基本实现

### 2. 生产者的同步发送消息

### 3. 生产者的异步发送消息

### 4. 生产者中的ack的配置

### 5. 关于消息发送的缓冲区

## 十一、Kafka—eagle监控平台

### 1.搭建

### 2.平台的使用

## 十、Kafka中的优化问题

### 1.如何防止消息丢失

### 2.如何防止重复消费

### 3.如何做到消息的顺序消费

### 4.如何解决消息积压问题

- 1) 消息积压问题的出现

- 2) 消息积压的解决方案

### 5.实现延时队列的效果

- 1) 应用场景

- 2) 具体方案

## 九、Kafka集群中的controller、rebalance、HW

### 1.controller

### 2.rebalance机制

### 3.HW和LEO

## 八、Springboot中使用Kafka

### 1.引入依赖

### 2.编写配置文件

### 3.编写消息生产者

### 4.编写消费者

### 5.消费者中配置消费主题、分区和偏移量

## 七、Java客户端消费者的实现细节

### 1.消费者的基本实现

### 2.关于消费者自动提交和手动提交offset

- 1) 提交的内容

- 2) 自动提交

- 3) 手动提交

### 3.长轮询poll消息

### 4.消费者的健康状态检查

### 5.指定分区和偏移量、时间消费

### 6.新消费组的消费offset规则
